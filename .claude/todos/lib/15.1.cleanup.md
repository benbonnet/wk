# 15.1 Cleanup - Post-Migration Updates

## Form Component → Formik

The Form component must provide actual Formik context for `useField` from "formik" to work.

```typescript
// adapters/custom/form/form.tsx
import { Formik, Form as FormikForm } from "formik";
import * as Yup from "yup";

// Replace custom useState implementation with Formik wrapper
```

---

## Stories to UPDATE (19 files → 2 files)

Consolidate into two story files:

### `adapters/formik-adapter.stories.tsx`

```typescript
import type { Meta, StoryObj } from "@storybook/react-vite";
import { FormikAdapter } from "./formik-adapter";
import { withForm } from "@storybook-decorators";

const meta: Meta<typeof FormikAdapter> = {
  title: "Adapters/FormikAdapter",
  component: FormikAdapter,
  tags: ["autodocs"],
  decorators: [withForm],
};

export default meta;
type Story = StoryObj<typeof FormikAdapter>;

export const Text: Story = {
  args: { type: "INPUT_TEXT", name: "email", label: "Email Address" },
};

export const Textarea: Story = {
  args: { type: "INPUT_TEXTAREA", name: "description", label: "Description", rows: 4 },
};

export const Select: Story = {
  args: {
    type: "INPUT_SELECT",
    name: "country",
    label: "Country",
    options: [
      { value: "us", label: "United States" },
      { value: "uk", label: "United Kingdom" },
    ],
  },
};

export const Checkbox: Story = {
  args: { type: "INPUT_CHECKBOX", name: "agree", label: "I agree to terms" },
};

export const Checkboxes: Story = {
  args: {
    type: "INPUT_CHECKBOXES",
    name: "notifications",
    label: "Notifications",
    options: [
      { value: "email", label: "Email" },
      { value: "sms", label: "SMS" },
    ],
  },
};

export const Radios: Story = {
  args: {
    type: "INPUT_RADIOS",
    name: "plan",
    label: "Plan",
    options: [
      { value: "free", label: "Free" },
      { value: "pro", label: "Pro" },
    ],
  },
};

export const Date: Story = {
  args: { type: "INPUT_DATE", name: "birthdate", label: "Birth Date" },
};

export const Datetime: Story = {
  args: { type: "INPUT_DATETIME", name: "appointment", label: "Appointment" },
};

export const Tags: Story = {
  args: { type: "INPUT_TAGS", name: "skills", label: "Skills" },
};

export const RichText: Story = {
  args: { type: "INPUT_AI_RICH_TEXT", name: "content", label: "Content", rows: 6 },
};
```

### `adapters/display-adapter.stories.tsx`

```typescript
import type { Meta, StoryObj } from "@storybook/react-vite";
import { DisplayAdapter } from "./display-adapter";

const meta: Meta<typeof DisplayAdapter> = {
  title: "Adapters/DisplayAdapter",
  component: DisplayAdapter,
  tags: ["autodocs"],
};

export default meta;
type Story = StoryObj<typeof DisplayAdapter>;

export const Text: Story = {
  args: { type: "DISPLAY_TEXT", name: "email", label: "Email", value: "test@example.com" },
};

export const Longtext: Story = {
  args: { type: "DISPLAY_LONGTEXT", name: "bio", label: "Bio", value: "Line 1\nLine 2" },
};

export const Number: Story = {
  args: { type: "DISPLAY_NUMBER", name: "amount", label: "Amount", value: 1234567.89 },
};

export const Date: Story = {
  args: { type: "DISPLAY_DATE", name: "created", label: "Created", value: "2024-01-15" },
};

export const Datetime: Story = {
  args: { type: "DISPLAY_DATETIME", name: "updated", label: "Updated", value: "2024-01-15T10:30:00" },
};

export const Badge: Story = {
  args: { type: "DISPLAY_BADGE", name: "status", label: "Status", value: "active" },
};

export const Tags: Story = {
  args: { type: "DISPLAY_TAGS", name: "tags", label: "Tags", value: ["react", "typescript"] },
};

export const Boolean: Story = {
  args: { type: "DISPLAY_BOOLEAN", name: "verified", label: "Verified", value: true },
};

export const SelectDisplay: Story = {
  args: {
    type: "DISPLAY_SELECT",
    name: "country",
    label: "Country",
    value: "us",
    options: [
      { value: "us", label: "United States" },
      { value: "uk", label: "United Kingdom" },
    ],
  },
};
```

### DELETE old story files (19):

```
adapters/text-input.stories.tsx
adapters/textarea.stories.tsx
adapters/select.stories.tsx
adapters/checkbox.stories.tsx
adapters/checkboxes.stories.tsx
adapters/radios.stories.tsx
adapters/date-input.stories.tsx
adapters/datetime-input.stories.tsx
adapters/tags-input.stories.tsx
adapters/rich-text-input.stories.tsx
adapters/text-display.stories.tsx
adapters/longtext-display.stories.tsx
adapters/number-display.stories.tsx
adapters/date-display.stories.tsx
adapters/datetime-display.stories.tsx
adapters/badge-display.stories.tsx
adapters/tags-display.stories.tsx
adapters/boolean-display.stories.tsx
adapters/select-display.stories.tsx
```

---

## Tests to REWRITE (2 files)

### `adapters/__tests__/inputs.test.tsx`

Current: imports `TextInput`, `Textarea`, etc. directly
New: test `FormikAdapter` with `type` prop

```typescript
import { describe, it, expect } from "vitest";
import { screen } from "@testing-library/react";
import userEvent from "@testing-library/user-event";
import { FormikAdapter } from "../formik-adapter";
import { renderWithFormik } from "./test-utils";

describe("FormikAdapter", () => {
  describe("INPUT_TEXT", () => {
    it("renders with label", () => {
      renderWithFormik(
        <FormikAdapter type="INPUT_TEXT" name="email" label="Email" />
      );
      expect(screen.getByLabelText("Email")).toBeInTheDocument();
    });
    // ... etc
  });

  describe("INPUT_SELECT", () => {
    // ...
  });
});
```

### `adapters/__tests__/displays.test.tsx`

Current: imports `TextDisplay`, `BadgeDisplay`, etc. directly
New: test `DisplayAdapter` with `type` prop

```typescript
import { DisplayAdapter } from "../display-adapter";

describe("DisplayAdapter", () => {
  describe("DISPLAY_TEXT", () => {
    it("displays value", () => {
      render(
        <DisplayAdapter
          type="DISPLAY_TEXT"
          name="email"
          value="test@example.com"
        />
      );
      expect(screen.getByText("test@example.com")).toBeInTheDocument();
    });
  });
});
```

---

## index.ts Update

```typescript
// adapters/index.ts

// Registry
export { adapterRegistry, type AdapterType, INPUT_TYPES, DISPLAY_TYPES } from "./registry";

// Unified adapters
export { FormikAdapter } from "./formik-adapter";
export { DisplayAdapter } from "./display-adapter";

// Layouts (unchanged)
export { Page } from "./page";
export { Drawer } from "./drawer";
export { Show, ShowContext, useShowData } from "./show";
export { Group } from "./group";
export { CardGroup } from "./card-group";
export { Multistep, MultistepContext, useMultistep } from "./multistep";
export { Step } from "./step";
export { DisplayArray } from "./display-array";
export { Alert } from "./alert";
export { Actions } from "./actions";

// Primitives (unchanged)
export { Button } from "./button";
export { Link } from "./link";
export { Dropdown } from "./dropdown";
export { Option } from "./option";
export { Search } from "./search";
export { Submit } from "./submit";

// Custom (unchanged)
export { View, DrawerContext, ViewContext, useDrawer, useViewConfig } from "./custom/view";
export { Table } from "./custom/table";
export { Form, FormContext, useFormContext, FormArray } from "./custom/form";
export { RelationshipPicker, RelationshipPickerField } from "./custom/relationship-picker";

// REMOVED: TextInput, Textarea, Select, Checkbox, Checkboxes, Radios,
//          DateInput, DatetimeInput, TagsInput, RichTextInput
// REMOVED: TextDisplay, LongtextDisplay, NumberDisplay, DateDisplay,
//          DatetimeDisplay, BadgeDisplay, TagsDisplay, BooleanDisplay, SelectDisplay
```

---

## Test Utils Update

### `adapters/__tests__/test-utils.tsx`

Add Formik wrapper:

```typescript
import { Formik } from "formik";

export function renderWithFormik(
  ui: React.ReactElement,
  { initialValues = {} } = {}
) {
  return renderWithProviders(
    <Formik initialValues={initialValues} onSubmit={() => {}}>
      {ui}
    </Formik>
  );
}
```

---

## Storybook Decorator

The `@storybook-decorators` alias needs `withForm` to provide Formik context:

```typescript
// wherever @storybook-decorators is defined
import { Formik } from "formik";

export const withForm = (Story) => (
  <Formik initialValues={{}} onSubmit={() => {}}>
    <Story />
  </Formik>
);
```

---

## Summary

| Category | Count | Action |
|----------|-------|--------|
| Stories | 19 → 2 | DELETE old, CREATE consolidated |
| Tests | 2 | REWRITE |
| index.ts | 1 | UPDATE (remove 19 exports) |
| Form component | 1 | REWRITE (Formik) |
| test-utils | 1 | ADD renderWithFormik |
| storybook decorator | 1 | UPDATE withForm |
