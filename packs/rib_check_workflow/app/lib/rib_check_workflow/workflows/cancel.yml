id: rib_check_cancel
name: RIB Check Cancel
version: "1.0"
description: Cancel a RIB request with activity log

inputs:
  workspace_id:
    type: integer
    required: true
    description: Workspace ID
  user_id:
    type: integer
    required: true
    description: User performing the action
  item_id:
    type: integer
    required: true
    description: RIB request item ID

steps:
  - id: start
    type: start
    next: update_status

  - id: update_status
    type: call
    service: ItemsService::Tools::Update
    method: execute
    input:
      user_id: "$input.user_id"
      workspace_id: "$input.workspace_id"
      id: "$input.item_id"
      data:
        status: "cancelled"
    output: item
    next: create_activity

  - id: create_activity
    type: call
    service: ActivitiesService::Tools::Create
    method: execute
    input:
      user_id: "$input.user_id"
      workspace_id: "$input.workspace_id"
      activity_type: "user_action"
      category: "data_access"
      level: "info"
      message: "Cancelled RIB request"
      item_id: "$item.id"
      schema_slug: "rib_request"
      tool_slug: "cancel"
    output: activity
    next: end

  - id: end
    type: end
    result:
      item: "$item"
      activity: "$activity"
