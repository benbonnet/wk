id: rib_check_update
name: RIB Check Update
version: "1.0"
description: Update a RIB request with activity log

inputs:
  workspace_id:
    type: integer
    required: true
    description: Workspace ID
  user_id:
    type: integer
    required: true
    description: User performing the action
  item_id:
    type: integer
    required: true
    description: RIB request item ID
  data:
    type: object
    required: true
    description: Updated RIB request data
    properties:
      comment:
        type: string
      message_body:
        type: string
      end_at:
        type: string
        format: date-time
      notify_via_email:
        type: boolean
      notify_via_sms:
        type: boolean
      request_type:
        type: string
        enum: [individual, common]
      status:
        type: string
        enum: [draft, pending, partial, completed, cancelled]

steps:
  - id: start
    type: start
    next: update_item

  - id: update_item
    type: call
    service: ItemsService::Tools::Update
    method: execute
    input:
      user_id: "$input.user_id"
      workspace_id: "$input.workspace_id"
      id: "$input.item_id"
      data: "$input.data"
    output: item
    next: create_activity

  - id: create_activity
    type: call
    service: ActivitiesService::Tools::Create
    method: execute
    input:
      user_id: "$input.user_id"
      workspace_id: "$input.workspace_id"
      activity_type: "user_action"
      category: "data_access"
      level: "info"
      message: "Updated RIB request"
      item_id: "$item.id"
      schema_slug: "rib_request"
      tool_slug: "update"
    output: activity
    next: end

  - id: end
    type: end
    result:
      item: "$item"
      activity: "$activity"
